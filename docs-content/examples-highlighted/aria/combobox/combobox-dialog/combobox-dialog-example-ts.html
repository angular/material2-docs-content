<span class="hljs-comment">/**
 * <span class="hljs-doctag">@license</span>
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.dev/license
 */</span>

<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">Combobox</span>,
  <span class="hljs-title class_">ComboboxDialog</span>,
  <span class="hljs-title class_">ComboboxInput</span>,
  <span class="hljs-title class_">ComboboxPopupContainer</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/aria/combobox&#x27;</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Listbox</span>, <span class="hljs-title class_">Option</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/aria/listbox&#x27;</span>;
<span class="hljs-keyword">import</span> {
  afterRenderEffect,
  <span class="hljs-title class_">ChangeDetectionStrategy</span>,
  <span class="hljs-title class_">Component</span>,
  computed,
  signal,
  untracked,
  viewChild,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/core&#x27;</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">FormsModule</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/forms&#x27;</span>;

<span class="hljs-comment">/** <span class="hljs-doctag">@title</span> Combobox with a dialog popup. */</span>
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">&#x27;combobox-dialog-example&#x27;</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">&#x27;combobox-dialog-example.html&#x27;</span>,
  <span class="hljs-attr">styleUrl</span>: <span class="hljs-string">&#x27;combobox-dialog-example.css&#x27;</span>,
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">ComboboxDialog</span>,
    <span class="hljs-title class_">Combobox</span>,
    <span class="hljs-title class_">ComboboxInput</span>,
    <span class="hljs-title class_">ComboboxPopupContainer</span>,
    <span class="hljs-title class_">Listbox</span>,
    <span class="hljs-title class_">Option</span>,
    <span class="hljs-title class_">FormsModule</span>,
  ],
  <span class="hljs-attr">changeDetection</span>: <span class="hljs-title class_">ChangeDetectionStrategy</span>.<span class="hljs-property">OnPush</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComboboxDialogExample</span> {
  dialog = <span class="hljs-title function_">viewChild</span>(<span class="hljs-title class_">ComboboxDialog</span>);
  listbox = viewChild&lt;<span class="hljs-title class_">Listbox</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;(<span class="hljs-title class_">Listbox</span>);
  combobox = viewChild&lt;<span class="hljs-title class_">Combobox</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;(<span class="hljs-title class_">Combobox</span>);

  value = <span class="hljs-title function_">signal</span>(<span class="hljs-string">&#x27;&#x27;</span>);
  searchString = <span class="hljs-title function_">signal</span>(<span class="hljs-string">&#x27;&#x27;</span>);

  options = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span>
    states.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">startsWith</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">searchString</span>().<span class="hljs-title function_">toLowerCase</span>())),
  );

  selectedStates = signal&lt;<span class="hljs-built_in">string</span>[]&gt;([]);

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">afterRenderEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dialog</span>() &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">combobox</span>()?.<span class="hljs-title function_">expanded</span>()) {
        <span class="hljs-title function_">untracked</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">listbox</span>()?.<span class="hljs-title function_">gotoFirst</span>());
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">positionDialog</span>();
      }
    });

    <span class="hljs-title function_">afterRenderEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">selectedStates</span>().<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">untracked</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dialog</span>()?.<span class="hljs-title function_">close</span>());
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">selectedStates</span>()[<span class="hljs-number">0</span>]);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchString</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;&#x27;</span>);
      }
    });

    <span class="hljs-title function_">afterRenderEffect</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">listbox</span>()?.<span class="hljs-title function_">scrollActiveItemIntoView</span>());
  }

  <span class="hljs-comment">// TODO(wagnermaciel): Switch to using the CDK for positioning.</span>

  <span class="hljs-title function_">positionDialog</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> dialog = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">dialog</span>()!;
    <span class="hljs-keyword">const</span> combobox = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">combobox</span>()!;

    <span class="hljs-keyword">const</span> comboboxRect = combobox.<span class="hljs-title function_">inputElement</span>()?.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> dialogEl = dialog.<span class="hljs-property">element</span>.<span class="hljs-property">nativeElement</span>;

    <span class="hljs-keyword">const</span> scrollY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>;

    <span class="hljs-keyword">if</span> (comboboxRect) {
      dialogEl.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${comboboxRect.width}</span>px`</span>;
      dialogEl.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${comboboxRect.bottom + scrollY + <span class="hljs-number">4</span>}</span>px`</span>;
      dialogEl.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">`<span class="hljs-subst">${comboboxRect.left - <span class="hljs-number">1</span>}</span>px`</span>;
    }
  }
}

<span class="hljs-keyword">const</span> states = [
  <span class="hljs-string">&#x27;Alabama&#x27;</span>,
  <span class="hljs-string">&#x27;Alaska&#x27;</span>,
  <span class="hljs-string">&#x27;Arizona&#x27;</span>,
  <span class="hljs-string">&#x27;Arkansas&#x27;</span>,
  <span class="hljs-string">&#x27;California&#x27;</span>,
  <span class="hljs-string">&#x27;Colorado&#x27;</span>,
  <span class="hljs-string">&#x27;Connecticut&#x27;</span>,
  <span class="hljs-string">&#x27;Delaware&#x27;</span>,
  <span class="hljs-string">&#x27;Florida&#x27;</span>,
  <span class="hljs-string">&#x27;Georgia&#x27;</span>,
  <span class="hljs-string">&#x27;Hawaii&#x27;</span>,
  <span class="hljs-string">&#x27;Idaho&#x27;</span>,
  <span class="hljs-string">&#x27;Illinois&#x27;</span>,
  <span class="hljs-string">&#x27;Indiana&#x27;</span>,
  <span class="hljs-string">&#x27;Iowa&#x27;</span>,
  <span class="hljs-string">&#x27;Kansas&#x27;</span>,
  <span class="hljs-string">&#x27;Kentucky&#x27;</span>,
  <span class="hljs-string">&#x27;Louisiana&#x27;</span>,
  <span class="hljs-string">&#x27;Maine&#x27;</span>,
  <span class="hljs-string">&#x27;Maryland&#x27;</span>,
  <span class="hljs-string">&#x27;Massachusetts&#x27;</span>,
  <span class="hljs-string">&#x27;Michigan&#x27;</span>,
  <span class="hljs-string">&#x27;Minnesota&#x27;</span>,
  <span class="hljs-string">&#x27;Mississippi&#x27;</span>,
  <span class="hljs-string">&#x27;Missouri&#x27;</span>,
  <span class="hljs-string">&#x27;Montana&#x27;</span>,
  <span class="hljs-string">&#x27;Nebraska&#x27;</span>,
  <span class="hljs-string">&#x27;Nevada&#x27;</span>,
  <span class="hljs-string">&#x27;New Hampshire&#x27;</span>,
  <span class="hljs-string">&#x27;New Jersey&#x27;</span>,
  <span class="hljs-string">&#x27;New Mexico&#x27;</span>,
  <span class="hljs-string">&#x27;New York&#x27;</span>,
  <span class="hljs-string">&#x27;North Carolina&#x27;</span>,
  <span class="hljs-string">&#x27;North Dakota&#x27;</span>,
  <span class="hljs-string">&#x27;Ohio&#x27;</span>,
  <span class="hljs-string">&#x27;Oklahoma&#x27;</span>,
  <span class="hljs-string">&#x27;Oregon&#x27;</span>,
  <span class="hljs-string">&#x27;Pennsylvania&#x27;</span>,
  <span class="hljs-string">&#x27;Rhode Island&#x27;</span>,
  <span class="hljs-string">&#x27;South Carolina&#x27;</span>,
  <span class="hljs-string">&#x27;South Dakota&#x27;</span>,
  <span class="hljs-string">&#x27;Tennessee&#x27;</span>,
  <span class="hljs-string">&#x27;Texas&#x27;</span>,
  <span class="hljs-string">&#x27;Utah&#x27;</span>,
  <span class="hljs-string">&#x27;Vermont&#x27;</span>,
  <span class="hljs-string">&#x27;Virginia&#x27;</span>,
  <span class="hljs-string">&#x27;Washington&#x27;</span>,
  <span class="hljs-string">&#x27;West Virginia&#x27;</span>,
  <span class="hljs-string">&#x27;Wisconsin&#x27;</span>,
  <span class="hljs-string">&#x27;Wyoming&#x27;</span>,
];
