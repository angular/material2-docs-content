<span class="hljs-comment">/**
 * <span class="hljs-doctag">@license</span>
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.dev/license
 */</span>

<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">Combobox</span>,
  <span class="hljs-title class_">ComboboxInput</span>,
  <span class="hljs-title class_">ComboboxPopup</span>,
  <span class="hljs-title class_">ComboboxPopupContainer</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/aria/combobox&#x27;</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Listbox</span>, <span class="hljs-title class_">Option</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/aria/listbox&#x27;</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">OverlayModule</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/cdk/overlay&#x27;</span>;
<span class="hljs-keyword">import</span> {
  afterRenderEffect,
  <span class="hljs-title class_">ChangeDetectionStrategy</span>,
  <span class="hljs-title class_">Component</span>,
  signal,
  viewChild,
  viewChildren,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@angular/core&#x27;</span>;

<span class="hljs-comment">/** <span class="hljs-doctag">@title</span> Readonly multiselectable combobox. */</span>
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">&#x27;combobox-readonly-multiselect-example&#x27;</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">&#x27;combobox-readonly-multiselect-example.html&#x27;</span>,
  <span class="hljs-attr">styleUrl</span>: <span class="hljs-string">&#x27;../select-examples.css&#x27;</span>,
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">Combobox</span>,
    <span class="hljs-title class_">ComboboxInput</span>,
    <span class="hljs-title class_">ComboboxPopup</span>,
    <span class="hljs-title class_">ComboboxPopupContainer</span>,
    <span class="hljs-title class_">Listbox</span>,
    <span class="hljs-title class_">Option</span>,
    <span class="hljs-title class_">OverlayModule</span>,
  ],
  <span class="hljs-attr">changeDetection</span>: <span class="hljs-title class_">ChangeDetectionStrategy</span>.<span class="hljs-property">OnPush</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComboboxReadonlyMultiselectExample</span> {
  <span class="hljs-comment">/** The string that is displayed in the combobox. */</span>
  displayValue = <span class="hljs-title function_">signal</span>(<span class="hljs-string">&#x27;&#x27;</span>);

  <span class="hljs-comment">/** The combobox listbox popup. */</span>
  listbox = viewChild&lt;<span class="hljs-title class_">Listbox</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;(<span class="hljs-title class_">Listbox</span>);

  <span class="hljs-comment">/** The options available in the listbox. */</span>
  options = viewChildren&lt;<span class="hljs-title class_">Option</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;(<span class="hljs-title class_">Option</span>);

  <span class="hljs-comment">/** A reference to the ng aria combobox. */</span>
  combobox = viewChild&lt;<span class="hljs-title class_">Combobox</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;(<span class="hljs-title class_">Combobox</span>);

  <span class="hljs-comment">/** The labels that are available for selection. */</span>
  labels = [
    {<span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;Important&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;label&#x27;</span>},
    {<span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;Starred&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;star&#x27;</span>},
    {<span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;Work&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;work&#x27;</span>},
    {<span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;Personal&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;person&#x27;</span>},
    {<span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;To Do&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;checklist&#x27;</span>},
    {<span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;Later&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;schedule&#x27;</span>},
    {<span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;Read&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;menu_book&#x27;</span>},
    {<span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;Travel&#x27;</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">&#x27;flight&#x27;</span>},
  ];

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// Updates the display value when the listbox values change.</span>
    <span class="hljs-title function_">afterRenderEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> values = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">listbox</span>()?.<span class="hljs-title function_">values</span>() || [];
      <span class="hljs-keyword">if</span> (values.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayValue</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Select a label&#x27;</span>);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (values.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayValue</span>.<span class="hljs-title function_">set</span>(values[<span class="hljs-number">0</span>]);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayValue</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">`<span class="hljs-subst">${values[<span class="hljs-number">0</span>]}</span> + <span class="hljs-subst">${values.length - <span class="hljs-number">1</span>}</span> more`</span>);
      }
    });

    <span class="hljs-comment">// Scrolls to the active item when the active option changes.</span>
    <span class="hljs-comment">// The slight delay here is to ensure animations are done before scrolling.</span>
    <span class="hljs-title function_">afterRenderEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> option = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">options</span>().<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> opt.<span class="hljs-title function_">active</span>());
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> option?.<span class="hljs-property">element</span>.<span class="hljs-title function_">scrollIntoView</span>({<span class="hljs-attr">block</span>: <span class="hljs-string">&#x27;nearest&#x27;</span>}), <span class="hljs-number">50</span>);
    });

    <span class="hljs-comment">// Resets the listbox scroll position when the combobox is closed.</span>
    <span class="hljs-title function_">afterRenderEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">combobox</span>()?.<span class="hljs-title function_">expanded</span>()) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">listbox</span>()?.<span class="hljs-property">element</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">150</span>);
      }
    });
  }
}
